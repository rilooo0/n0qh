<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOAH | Street & Y2K Vintage Store</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;700&family=Inter:wght@400;900&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        // Fixed: Imported signInWithCustomToken
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, deleteDoc, updateDoc, doc, onSnapshot, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Fixed: Consolidated config initialization
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        
        // Initialize Firebase
        // Fallback for standalone viewing (won't work for DB without real config)
        const app = initializeApp(firebaseConfig || {apiKey: "AIza...", authDomain: "...", projectId: "..."});
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Global State
        window.isAdmin = false;
        let currentUser = null;

        // Authentication
        const initAuth = async () => {
            try {
                // Fixed: Properly handle custom token if available in the environment
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Auth Error:", error);
            }
        };

        initAuth();

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                console.log("User authenticated:", user.uid);
                // Only start listeners after auth is confirmed
                initRealtimeListeners();
            }
        });

        // Database Collections
        const SHOP_COLLECTION = `artifacts/${appId}/public/data/shop_items`;
        const STYLE_COLLECTION = `artifacts/${appId}/public/data/style_model`;

        // Initial Data Seeding
        const seedData = {
            shop: [
                {
                    title: "00's CYBER GRAPHIC TEE",
                    price: "¥8,800",
                    image: "images/item1.jpg",
                    tag: "VINTAGE",
                    link: "https://jp.mercari.com/user/profile/532695058?utm_medium=share&utm_source=ios",
                    isRecommended: true, 
                    createdAt: Date.now()
                },
                {
                    title: "WIDE SILHOUETTE DENIM",
                    price: "¥12,000",
                    image: "images/item2.jpg",
                    tag: "Y2K",
                    link: "https://jp.mercari.com/user/profile/532695058?utm_medium=share&utm_source=ios",
                    isRecommended: false,
                    createdAt: Date.now() - 1000
                },
                {
                    title: "TECH NYLON JACKET",
                    price: "¥15,800",
                    image: "images/item3.jpg",
                    tag: "TECH",
                    link: "https://jp.mercari.com/user/profile/532695058?utm_medium=share&utm_source=ios",
                    isRecommended: true,
                    createdAt: Date.now() - 2000
                }
            ],
            style: [
                { image: "images/look1.jpg", label: "STYLE 01", createdAt: Date.now() },
                { image: "images/look2.jpg", label: "", createdAt: Date.now() - 1000 },
                { image: "images/look3.jpg", label: "", createdAt: Date.now() - 2000 },
                { image: "images/look4.jpg", label: "", createdAt: Date.now() - 3000 },
                { image: "images/look5.jpg", label: "STYLE 02", createdAt: Date.now() - 4000 }
            ]
        };

        // Listeners
        function initRealtimeListeners() {
            // Shop Listener
            onSnapshot(collection(db, SHOP_COLLECTION), (snapshot) => {
                const items = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                if (items.length === 0 && window.isAdmin) {
                    renderShop(seedData.shop, true);
                    renderHomeRecommendations(seedData.shop.filter(i => i.isRecommended), true);
                } else if (items.length > 0) {
                    items.sort((a, b) => b.createdAt - a.createdAt);
                    renderShop(items, false);
                    
                    // Render Recommendations on Home
                    const recommended = items.filter(item => item.isRecommended);
                    renderHomeRecommendations(recommended, false);
                } else {
                     renderShop(seedData.shop, true);
                     renderHomeRecommendations(seedData.shop.filter(i => i.isRecommended), true);
                }
            }, (error) => console.error("Shop sync error:", error));

            // Style Model Listener
            onSnapshot(collection(db, STYLE_COLLECTION), (snapshot) => {
                const items = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                if (items.length === 0) {
                     renderStyle(seedData.style, true);
                } else {
                    items.sort((a, b) => b.createdAt - a.createdAt);
                    renderStyle(items, false);
                }
            }, (error) => console.error("Style sync error:", error));
        }

        // Render Functions
        window.renderShop = (items, isVirtual) => {
            const container = document.getElementById('shop-grid');
            if (!container) return;
            container.innerHTML = '';

            items.forEach(item => {
                const card = document.createElement('div');
                card.className = "group border border-gray-800 bg-noah-black hover:border-noah-green transition duration-300 relative";
                
                const fallbackImg = 'https://images.unsplash.com/photo-1578587018452-892bacefd3f2?q=80&w=600&auto=format&fit=crop';
                
                // Admin Controls (Delete & Recommend)
                let adminControls = '';
                if (window.isAdmin && !isVirtual) {
                    const isRec = item.isRecommended ? 'text-yellow-400' : 'text-gray-600 hover:text-yellow-400';
                    adminControls = `
                        <div class="absolute top-2 left-2 z-20 flex space-x-2">
                            <button onclick="deleteItem('${SHOP_COLLECTION}', '${item.id}')" class="bg-red-600 text-white w-8 h-8 rounded flex items-center justify-center hover:bg-red-700">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button onclick="toggleRecommend('${item.id}', ${item.isRecommended || false})" class="bg-white ${isRec} w-8 h-8 rounded flex items-center justify-center transition-colors">
                                <i class="fas fa-star"></i>
                            </button>
                        </div>
                    `;
                }

                card.innerHTML = `
                    ${adminControls}
                    <a href="${item.link}" target="_blank" class="block relative overflow-hidden aspect-[3/4]">
                        <img src="${item.image}" 
                             onerror="this.src='${fallbackImg}'; this.onerror=null;"
                             class="w-full h-full object-cover group-hover:scale-105 transition duration-500" alt="${item.title}">
                        ${item.tag ? `<div class="absolute top-2 right-2 bg-noah-green text-black text-xs font-bold px-2 py-1">${item.tag}</div>` : ''}
                    </a>
                    <div class="p-6">
                        <a href="${item.link}" target="_blank" class="block">
                            <h3 class="text-xl font-bold mb-2 group-hover:text-noah-green transition-colors line-clamp-2">${item.title}</h3>
                        </a>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">${item.price}</span>
                            <a href="${item.link}" target="_blank" class="text-noah-green hover:text-white uppercase text-sm font-bold border-b border-noah-green pb-1">Buy <i class="fas fa-external-link-alt ml-1"></i></a>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        };

        window.renderHomeRecommendations = (items, isVirtual) => {
            const container = document.getElementById('home-recommended-grid');
            if (!container) return;
            
            if (items.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-500">No recommendations selected yet.</div>';
                return;
            }

            container.innerHTML = '';
            // Only show up to 4 items
            items.slice(0, 4).forEach(item => {
                const card = document.createElement('div');
                card.className = "group border border-gray-800 bg-noah-black/50 hover:border-noah-green transition duration-300";
                
                const fallbackImg = 'https://images.unsplash.com/photo-1578587018452-892bacefd3f2?q=80&w=600&auto=format&fit=crop';
                
                card.innerHTML = `
                    <a href="${item.link}" target="_blank" class="block relative overflow-hidden aspect-square">
                        <img src="${item.image}" 
                             onerror="this.src='${fallbackImg}'; this.onerror=null;"
                             class="w-full h-full object-cover group-hover:scale-105 transition duration-500" alt="${item.title}">
                    </a>
                    <div class="p-4">
                        <h4 class="text-sm font-bold mb-1 truncate text-white group-hover:text-noah-green">${item.title}</h4>
                        <p class="text-xs text-gray-400">${item.price}</p>
                    </div>
                `;
                container.appendChild(card);
            });
        };

        window.renderStyle = (items, isVirtual) => {
            const container = document.getElementById('style-grid');
            if (!container) return;
            container.innerHTML = '';

            items.forEach(item => {
                const div = document.createElement('div');
                div.className = "relative group break-inside-avoid mb-4";
                
                if (window.isAdmin && !isVirtual) {
                    const delBtn = document.createElement('button');
                    delBtn.innerHTML = '<i class="fas fa-trash"></i>';
                    delBtn.className = "absolute top-2 left-2 z-20 bg-red-600 text-white p-2 rounded hover:bg-red-700";
                    delBtn.onclick = (e) => { e.preventDefault(); deleteItem(STYLE_COLLECTION, item.id); };
                    div.appendChild(delBtn);
                }

                const fallbackImg = 'https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?q=80&w=600&auto=format&fit=crop';

                div.innerHTML += `
                    <img src="${item.image}" 
                         onerror="this.src='${fallbackImg}'; this.onerror=null;"
                         class="w-full h-auto border border-transparent group-hover:border-noah-green transition">
                    ${item.label ? `
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
                        <span class="text-noah-green font-bold text-xl">${item.label}</span>
                    </div>` : ''}
                `;
                container.appendChild(div);
            });
        };

        // Helper: Resize Image
        const resizeImage = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        // Max dimensions to keep Firestore document size small
                        const MAX_WIDTH = 800;
                        const MAX_HEIGHT = 800;
                        let width = img.width;
                        let height = img.height;

                        if (width > height) {
                            if (width > MAX_WIDTH) {
                                height *= MAX_WIDTH / width;
                                width = MAX_WIDTH;
                            }
                        } else {
                            if (height > MAX_HEIGHT) {
                                width *= MAX_HEIGHT / height;
                                height = MAX_HEIGHT;
                            }
                        }

                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        // Convert to jpeg with 0.7 quality to save space
                        resolve(canvas.toDataURL('image/jpeg', 0.7)); 
                    };
                    img.src = event.target.result;
                };
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        };

        // Actions
        window.addItem = async (type) => {
            if (!currentUser) return;
            
            try {
                if (type === 'shop') {
                    const title = document.getElementById('shop-title').value;
                    const price = document.getElementById('shop-price').value;
                    const fileInput = document.getElementById('shop-image-file');
                    const tag = document.getElementById('shop-tag').value;
                    const link = document.getElementById('shop-link').value;
                    
                    if(!title || fileInput.files.length === 0) return alert("Title and Image are required");

                    // Show loading state (simple alert for now or update UI text)
                    const submitBtn = document.querySelector('#shop-form button[type="submit"]');
                    const originalText = submitBtn.innerText;
                    submitBtn.innerText = "Processing Image...";
                    submitBtn.disabled = true;

                    try {
                        const image = await resizeImage(fileInput.files[0]);
                        
                        await addDoc(collection(db, SHOP_COLLECTION), {
                            title, price, image, tag, link, 
                            isRecommended: false, 
                            createdAt: Date.now()
                        });
                        
                        document.getElementById('shop-form').reset();
                        alert("Item Added!");
                    } finally {
                        submitBtn.innerText = originalText;
                        submitBtn.disabled = false;
                    }

                } else if (type === 'style') {
                    const fileInput = document.getElementById('style-image-file');
                    const label = document.getElementById('style-label').value;

                    if(fileInput.files.length === 0) return alert("Image is required");
                    
                    const submitBtn = document.querySelector('#style-form button[type="submit"]');
                    const originalText = submitBtn.innerText;
                    submitBtn.innerText = "Processing Image...";
                    submitBtn.disabled = true;

                    try {
                        const image = await resizeImage(fileInput.files[0]);

                        await addDoc(collection(db, STYLE_COLLECTION), {
                            image, label, createdAt: Date.now()
                        });

                        document.getElementById('style-form').reset();
                        alert("Style Added!");
                    } finally {
                        submitBtn.innerText = originalText;
                        submitBtn.disabled = false;
                    }
                }
            } catch (e) {
                console.error(e);
                alert("Error adding item: " + e.message);
            }
        };

        window.toggleRecommend = async (docId, currentStatus) => {
            try {
                await updateDoc(doc(db, SHOP_COLLECTION, docId), {
                    isRecommended: !currentStatus
                });
            } catch (e) {
                console.error(e);
                alert("Error updating recommendation: " + e.message);
            }
        };

        window.deleteItem = async (collectionPath, docId) => {
            if(!confirm("Are you sure you want to delete this item?")) return;
            try {
                await deleteDoc(doc(db, collectionPath, docId));
            } catch (e) {
                console.error(e);
                alert("Error deleting: " + e.message);
            }
        };

        // Admin Toggle
        window.toggleAdmin = () => {
            // ... legacy placeholder
        }
        
        if (localStorage.getItem('noah_admin') === 'true') {
            window.isAdmin = true;
            document.body.classList.add('admin-mode');
        }

        window.realToggleAdmin = () => {
             const current = localStorage.getItem('noah_admin') === 'true';
             if (current) {
                 localStorage.setItem('noah_admin', 'false');
                 window.isAdmin = false;
                 alert("Admin Mode: OFF");
             } else {
                 const pass = prompt("Enter Admin Password:");
                 if (pass === 'noah') {
                     localStorage.setItem('noah_admin', 'true');
                     window.isAdmin = true;
                     alert("Admin Mode: ON\nGo to SHOP to select recommended items (Star icon).");
                 } else {
                     alert("Invalid Password");
                 }
             }
             location.reload();
        }

    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'noah-black': '#050505',
                        'noah-green': '#ccff00', 
                        'noah-gray': '#1a1a1a',
                        'noah-silver': '#e0e0e0',
                    },
                    fontFamily: {
                        'display': ['"Chakra Petch"', 'sans-serif'],
                        'body': ['"Inter"', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Styles for Y2K/Street Vibe */
        body {
            background-color: #050505;
            color: #e0e0e0;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        h1, h2, h3, .nav-item {
            font-family: 'Chakra Petch', sans-serif;
            text-transform: uppercase;
        }

        .glitch-hover:hover {
            text-shadow: 2px 0 #ccff00, -2px 0 #ff00ea;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #050505;
        }
        ::-webkit-scrollbar-thumb {
            background: #ccff00;
            border-radius: 0;
        }

        .bg-grid {
            background-size: 40px 40px;
            background-image: linear-gradient(to right, #1a1a1a 1px, transparent 1px),
                              linear-gradient(to bottom, #1a1a1a 1px, transparent 1px);
        }

        .btn-primary {
            background-color: transparent;
            border: 1px solid #ccff00;
            color: #ccff00;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #ccff00;
            color: #000;
            box-shadow: 0 0 15px rgba(204, 255, 0, 0.5);
        }

        .nav-link.active {
            color: #ccff00;
            border-bottom: 2px solid #ccff00;
        }
        
        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease;
        }

        .admin-panel {
            display: none;
        }
        body.admin-mode .admin-panel {
            display: block;
            border: 1px dashed #ccff00;
            padding: 20px;
            margin-bottom: 20px;
            background: rgba(204, 255, 0, 0.05);
        }
    </style>
</head>
<body class="bg-noah-black text-white relative">

    <!-- Loading Screen -->
    <div id="loader" class="loader-overlay">
        <h1 class="text-6xl font-display font-bold text-noah-green tracking-tighter animate-pulse">NOAH</h1>
    </div>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 bg-noah-black/90 backdrop-blur-sm border-b border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex-shrink-0 cursor-pointer" onclick="switchPage('home')">
                    <span class="text-3xl font-bold font-display tracking-widest text-white glitch-hover">NOAH</span>
                </div>
                
                <!-- Desktop Menu -->
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-8">
                        <button onclick="switchPage('home')" class="nav-link active hover:text-noah-green px-3 py-2 text-sm font-medium transition-colors">HOME</button>
                        <button onclick="switchPage('about')" class="nav-link hover:text-noah-green px-3 py-2 text-sm font-medium transition-colors">ABOUT</button>
                        <button onclick="switchPage('shop')" class="nav-link hover:text-noah-green px-3 py-2 text-sm font-medium transition-colors">SHOP</button>
                        <button onclick="switchPage('stylemodel')" class="nav-link hover:text-noah-green px-3 py-2 text-sm font-medium transition-colors">STYLEMODEL</button>
                        <button onclick="switchPage('contact')" class="nav-link hover:text-noah-green px-3 py-2 text-sm font-medium transition-colors">CONTACT</button>
                    </div>
                </div>

                <!-- Mobile menu button -->
                <div class="md:hidden">
                    <button onclick="toggleMobileMenu()" class="text-white hover:text-noah-green focus:outline-none">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu Panel -->
        <div id="mobile-menu" class="hidden md:hidden bg-noah-black border-b border-gray-800">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <button onclick="switchPage('home')" class="text-gray-300 hover:text-noah-green block px-3 py-2 rounded-md text-base font-medium w-full text-left">HOME</button>
                <button onclick="switchPage('about')" class="text-gray-300 hover:text-noah-green block px-3 py-2 rounded-md text-base font-medium w-full text-left">ABOUT</button>
                <button onclick="switchPage('shop')" class="text-gray-300 hover:text-noah-green block px-3 py-2 rounded-md text-base font-medium w-full text-left">SHOP</button>
                <button onclick="switchPage('stylemodel')" class="text-gray-300 hover:text-noah-green block px-3 py-2 rounded-md text-base font-medium w-full text-left">STYLEMODEL</button>
                <button onclick="switchPage('contact')" class="text-gray-300 hover:text-noah-green block px-3 py-2 rounded-md text-base font-medium w-full text-left">CONTACT</button>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <main class="pt-20 min-h-screen bg-grid">
        
        <!-- PAGE 1: HOME -->
        <section id="home" class="page-section fade-in">
            <!-- Hero Section -->
            <div class="relative h-[80vh] flex items-center justify-center overflow-hidden">
                <div class="absolute inset-0 z-0 opacity-50">
                    <img src="images/hero.jpg" 
                         onerror="this.src='https://images.unsplash.com/photo-1523398002811-999ca8dec234?q=80&w=2000&auto=format&fit=crop'; this.onerror=null;" 
                         class="w-full h-full object-cover" alt="NOAH Vibes">
                </div>
                
                <div class="relative z-10 text-center px-4">
                    <h2 class="text-noah-green text-lg md:text-xl font-bold tracking-[0.5em] mb-4">EST. 2025 TOKYO</h2>
                    <h1 class="text-6xl md:text-9xl font-display font-bold text-white mb-6 border-2 border-white p-4 inline-block backdrop-blur-sm">
                        NOAH
                    </h1>
                    <p class="text-gray-300 text-xl mb-8 max-w-2xl mx-auto font-light">
                        DIGITAL NOSTALGIA & STREET CULTURE
                    </p>
                    <button onclick="switchPage('shop')" class="btn-primary px-8 py-4 text-xl font-bold tracking-wider uppercase">
                        Check New Drops
                    </button>
                </div>
            </div>

            <!-- Marquee Text -->
            <div class="bg-noah-green text-black py-3 overflow-hidden whitespace-nowrap border-y-2 border-white">
                <div class="animate-marquee inline-block font-bold text-xl font-display">
                    NEW ARRIVALS EVERY WEEK +++ VINTAGE & SELECTED ITEMS +++ WORLDWIDE SHIPPING +++ NOAH STREET WEAR +++ 
                    NEW ARRIVALS EVERY WEEK +++ VINTAGE & SELECTED ITEMS +++ WORLDWIDE SHIPPING +++ NOAH STREET WEAR +++
                </div>
            </div>

            <!-- Recommended Section (New) -->
            <div class="max-w-7xl mx-auto px-4 py-16">
                <div class="flex items-center justify-between mb-8">
                    <h3 class="text-2xl md:text-3xl font-display font-bold text-white border-l-4 border-noah-green pl-4">RECOMMENDED PICKUPS</h3>
                    <button onclick="switchPage('shop')" class="text-sm text-gray-400 hover:text-noah-green transition">VIEW ALL <i class="fas fa-arrow-right ml-1"></i></button>
                </div>
                
                <!-- This grid is populated by JS with items where isRecommended = true -->
                <div id="home-recommended-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
                    <div class="col-span-full text-center text-gray-600 py-8">Loading recommendations...</div>
                </div>
            </div>
        </section>

        <!-- PAGE 2: ABOUT -->
        <section id="about" class="page-section hidden max-w-4xl mx-auto px-4 py-16">
            <div class="flex flex-col md:flex-row gap-12 items-center">
                <div class="w-full md:w-1/2">
                    <img src="images/about.jpg" 
                         onerror="this.src='https://images.unsplash.com/photo-1612462766564-9ca1e72d2361?q=80&w=800&auto=format&fit=crop'; this.onerror=null;"
                         class="w-full h-auto border-2 border-noah-green grayscale hover:grayscale-0 transition duration-500" alt="About NOAH">
                </div>
                <div class="w-full md:w-1/2">
                    <h2 class="text-5xl font-display font-bold text-white mb-6">WHO WE ARE</h2>
                    <div class="w-20 h-1 bg-noah-green mb-8"></div>
                    <p class="text-gray-300 leading-relaxed mb-6">
                        NOAHは、2000年代のカルチャーと現代のストリートシーンを融合させる実験的な古着屋です。
                    </p>
                    <p class="text-gray-300 leading-relaxed mb-6">
                        Y2Kのデジタリズム、90年代の無骨さ、そして未来的なシルエット。
                        私たちは単に服を売るのではなく、スタイルという「態度」を提案します。
                    </p>
                </div>
            </div>
        </section>

        <!-- PAGE 3: SHOP -->
        <section id="shop" class="page-section hidden max-w-7xl mx-auto px-4 py-16">
            <div class="text-center mb-16">
                <h2 class="text-4xl md:text-6xl font-display font-bold mb-4">LATEST DROPS</h2>
                <p class="text-noah-green">CLICK ITEM TO BUY ON MERCARI</p>
            </div>

            <!-- ADMIN ADD ITEM FORM -->
            <div class="admin-panel max-w-2xl mx-auto mb-12">
                <h3 class="text-noah-green font-bold mb-4"><i class="fas fa-plus-circle"></i> ADD NEW ITEM</h3>
                <form id="shop-form" onsubmit="event.preventDefault(); addItem('shop');" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" id="shop-title" placeholder="Item Name" class="bg-black border border-gray-700 p-2 w-full text-white">
                        <input type="text" id="shop-price" placeholder="Price (e.g. ¥5,000)" class="bg-black border border-gray-700 p-2 w-full text-white">
                    </div>
                    <!-- CHANGED: File input instead of Text URL -->
                    <div class="relative">
                        <label class="block text-xs text-gray-500 mb-1">Upload Image (Max 800px resized auto)</label>
                        <input type="file" id="shop-image-file" accept="image/*" class="bg-black border border-gray-700 p-2 w-full text-white file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-noah-green file:text-black hover:file:bg-white">
                    </div>
                    <input type="text" id="shop-tag" placeholder="Tag (e.g. Y2K, VINTAGE)" class="bg-black border border-gray-700 p-2 w-full text-white">
                    <input type="text" id="shop-link" value="https://jp.mercari.com/user/profile/532695058?utm_medium=share&utm_source=ios" placeholder="Mercari Link" class="bg-black border border-gray-700 p-2 w-full text-white">
                    <button type="submit" class="bg-noah-green text-black font-bold py-2 px-4 w-full hover:bg-white transition">ADD TO SHOP</button>
                    <p class="text-xs text-gray-500 mt-2">* Added items will appear in the list below. Click the <i class="fas fa-star text-yellow-500"></i> icon on the card to feature it on the Home page.</p>
                </form>
            </div>

            <!-- Shop Grid (Populated by JS) -->
            <div id="shop-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Loading State / Content populated by JS -->
                <div class="col-span-full text-center text-gray-500 py-12">Loading items...</div>
            </div>
            
            <div class="text-center mt-12">
                <a href="https://jp.mercari.com/user/profile/532695058?utm_medium=share&utm_source=ios" target="_blank" class="inline-block border border-gray-600 text-gray-400 hover:border-noah-green hover:text-noah-green px-6 py-3 transition">
                    VIEW ALL ITEMS ON MERCARI
                </a>
            </div>
        </section>

        <!-- PAGE 4: STYLEMODEL (Formerly Lookbook) -->
        <section id="stylemodel" class="page-section hidden max-w-7xl mx-auto px-4 py-16">
            <h2 class="text-6xl font-display font-bold text-center mb-12 stroke-text">STYLE MODEL</h2>
            
            <!-- ADMIN ADD PHOTO FORM -->
            <div class="admin-panel max-w-2xl mx-auto mb-12">
                <h3 class="text-noah-green font-bold mb-4"><i class="fas fa-camera"></i> ADD STYLE PHOTO</h3>
                <form id="style-form" onsubmit="event.preventDefault(); addItem('style');" class="space-y-4">
                    <!-- CHANGED: File input instead of Text URL -->
                    <div class="relative">
                        <label class="block text-xs text-gray-500 mb-1">Upload Photo</label>
                        <input type="file" id="style-image-file" accept="image/*" class="bg-black border border-gray-700 p-2 w-full text-white file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-noah-green file:text-black hover:file:bg-white">
                    </div>
                    <input type="text" id="style-label" placeholder="Label (Optional, e.g. STYLE 01)" class="bg-black border border-gray-700 p-2 w-full text-white">
                    <button type="submit" class="bg-noah-green text-black font-bold py-2 px-4 w-full hover:bg-white transition">ADD TO STYLE MODEL</button>
                </form>
            </div>

            <!-- Masonry-style Layout (Populated by JS) -->
            <div id="style-grid" class="columns-1 md:columns-2 lg:columns-3 gap-4 space-y-4">
                 <div class="text-center text-gray-500 py-12 w-full">Loading gallery...</div>
            </div>
        </section>

        <!-- PAGE 5: CONTACT -->
        <section id="contact" class="page-section hidden max-w-2xl mx-auto px-4 py-16">
            <div class="border border-gray-800 bg-noah-black/50 p-8 md:p-12 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-20 h-20 border-t-2 border-r-2 border-noah-green"></div>
                
                <h2 class="text-4xl font-display font-bold mb-4 text-center">GET IN TOUCH</h2>
                <p class="text-center text-gray-400 mb-8">
                    Contact us directly at: <br>
                    <a href="mailto:longshus32@gmail.com" class="text-noah-green font-bold text-xl hover:underline">longshus32@gmail.com</a>
                </p>
                
                <div class="mt-12 pt-8 border-t border-gray-800">
                    <h3 class="text-center text-lg mb-6 font-display">FOLLOW US</h3>
                    <div class="flex justify-center space-x-6 md:space-x-8">
                        <a href="https://www.instagram.com/_n0qh_official?igsh=MWo3ZTc1emZpbXJuYg%3D%3D&utm_source=qr" target="_blank" class="group flex flex-col items-center">
                            <div class="w-12 h-12 flex items-center justify-center border border-gray-600 rounded-full group-hover:border-noah-green group-hover:text-noah-green transition-all">
                                <i class="fab fa-instagram text-2xl"></i>
                            </div>
                            <span class="text-xs mt-2 text-gray-500 group-hover:text-noah-green">INSTAGRAM</span>
                        </a>
                        <a href="https://www.tiktok.com/@n0qhofficial?_r=1&_t=ZS-928fDtTlRcm" target="_blank" class="group flex flex-col items-center">
                            <div class="w-12 h-12 flex items-center justify-center border border-gray-600 rounded-full group-hover:border-noah-green group-hover:text-noah-green transition-all">
                                <i class="fab fa-tiktok text-2xl"></i>
                            </div>
                            <span class="text-xs mt-2 text-gray-500 group-hover:text-noah-green">TIKTOK</span>
                        </a>
                        <a href="https://jp.mercari.com/user/profile/532695058?utm_medium=share&utm_source=ios" target="_blank" class="group flex flex-col items-center">
                            <div class="w-12 h-12 flex items-center justify-center border border-gray-600 rounded-full group-hover:border-noah-green group-hover:text-noah-green transition-all">
                                <i class="fas fa-shopping-bag text-2xl"></i>
                            </div>
                            <span class="text-xs mt-2 text-gray-500 group-hover:text-noah-green">MERCARI</span>
                        </a>
                        <a href="https://n0qh.base.shop/" target="_blank" class="group flex flex-col items-center">
                            <div class="w-12 h-12 flex items-center justify-center border border-gray-600 rounded-full group-hover:border-noah-green group-hover:text-noah-green transition-all">
                                <i class="fas fa-store text-2xl"></i>
                            </div>
                            <span class="text-xs mt-2 text-gray-500 group-hover:text-noah-green">BASE SHOP</span>
                        </a>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-black border-t border-gray-900 py-8 mt-auto">
        <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center">
            <div class="text-2xl font-display font-bold text-white mb-4 md:mb-0">NOAH</div>
            <div class="text-gray-600 text-sm">
                &copy; 2025 NOAH STORE. ALL RIGHTS RESERVED.
            </div>
            <div class="flex items-center space-x-6 mt-4 md:mt-0 text-gray-500 text-sm">
                <!-- Admin Toggle Button -->
                <button onclick="realToggleAdmin()" class="text-gray-700 hover:text-noah-green transition" title="Admin Access">
                    <i class="fas fa-lock"></i>
                </button>
            </div>
        </div>
    </footer>

    <!-- JavaScript for SPA Functionality -->
    <script>
        // Loading Animation
        window.addEventListener('load', () => {
            const loader = document.getElementById('loader');
            setTimeout(() => {
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                }, 500);
            }, 1000);
        });

        // Mobile Menu Toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        // Page Switching Logic
        function switchPage(pageId) {
            const sections = document.querySelectorAll('.page-section');
            sections.forEach(section => {
                section.classList.add('hidden');
            });
            const selectedSection = document.getElementById(pageId);
            if(selectedSection) selectedSection.classList.remove('hidden');

            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.classList.remove('active');
                if(link.textContent.replace(/\s/g,'').toLowerCase() === pageId) {
                    link.classList.add('active');
                }
            });
            window.scrollTo(0, 0);
            document.getElementById('mobile-menu').classList.add('hidden');
        }

        tailwind.config.theme.extend.keyframes = {
            marquee: {
                '0%': { transform: 'translateX(0%)' },
                '100%': { transform: 'translateX(-100%)' },
            }
        }
        tailwind.config.theme.extend.animation = {
            marquee: 'marquee 20s linear infinite',
        }
    </script>
</body>
</html>